'PIC16F884
'open Tools->LCD Module
'open Tools->Microcontroller View
'change analog Ra0

'????????? LCD ?????? ??? ????? ????????????????
Define LCD_BITS = 8
Define LCD_DREG = PORTB
Define LCD_DBIT = 0
Define LCD_RSREG = PORTD
Define LCD_RSBIT = 1
Define LCD_EREG = PORTD
Define LCD_EBIT = 3
Define LCD_RWREG = PORTD
Define LCD_RWBIT = 2

Dim i As Byte  '??????? ??????????

TRISA = %11111111  '????????? ?????? A ?? ????(?? 8)

Dim an0 As Long  '??????? ??????????
Dim maxvolt As Long  '??????? ??????????
Dim procent As Long  '??????? ??????????
Dim characters As Byte  '??????? ??????????
Dim fived As Byte  '??????? ??????????
Dim four As Byte  '??????? ??????????
Dim volt As Single  '??????? ??????????
Lcdinit 0  '???????????????? ??????? ?? LCD

characters = 16  'LCD 2 X 16 (16-4)
maxvolt = 1024
Lcddefchar 1, %10000, %10000, %10000, %10000, %10000, %10000, %10000, %10000  '?????? ???????? ?????????? 1
Lcddefchar 2, %11000, %11000, %11000, %11000, %11000, %11000, %11000, %11000  '?????? ???????? ?????????? 2
Lcddefchar 3, %11100, %11100, %11100, %11100, %11100, %11100, %11100, %11100  '?????? ???????? ?????????? 3
Lcddefchar 4, %11110, %11110, %11110, %11110, %11110, %11110, %11110, %11110  '?????? ???????? ?????????? 4
Lcddefchar 5, %11111, %11111, %11111, %11111, %11111, %11111, %11111, %11111  '?????? ???????? ?????????? 5

Dim five As Byte  '??????? ??????????

loop:  '?????? main

Adcin 0, an0  '????? ???????? ? ??????????? ????? A0

volt = an0 * 5 / 1023
Lcdout "Vol: ", #volt, "V ", #procent, "%"  '?????? ?? ????? ???????? ?????

Lcdcmdout LcdLine2Home  '??????? ?? ????? ???????

procent = an0 * 100 / 1023  '???????? ???????? ? %

fived = 100 / characters  '????????? ???????? ? % ??? ?????? ?????????? 5?5
five = procent / fived  '????????? ???-?? ???????????

'Lcdout #procent, "%"  '?????????? ???????? ? ?????????


For i = 1 To five Step 1  '???? ??? ?????????? ??????????? 5?5
Lcdout 5
Next i

four = procent - fived * five  '????????? ?????????? ????????, ??????? ?? ??????????

If four > 4 Then  '?????????? ?????????? ????????
Lcdout 4  '?????????? ???????? ???????????? ?? ??????? 32
Goto loopend
Endif

If four > 3 Then  '?????????? ?????????? ????????
Lcdout 3  '?????????? ???????? ???????????? ?? ??????? 31
Goto loopend
Endif

If four > 2 Then  '?????????? ?????????? ????????
Lcdout 2  '?????????? ???????? ???????????? ?? ??????? 30
Goto loopend
Endif

If four > 1 Then  '?????????? ?????????? ????????
Lcdout 1  '?????????? ???????? ???????????? ?? ??????? 29
Endif

loopend:

WaitMs 100
Lcdcmdout LcdClear  '???????? ?????

Goto loop